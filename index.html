<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>华彬闳的Blog  | Ananke: a Hugo Theme</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.59.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    
    
      <link href="/index.xml" rel="alternate" type="application/rss+xml" title="华彬闳的Blog" />
      <link href="/index.xml" rel="feed" type="application/rss+xml" title="华彬闳的Blog" />
      
    
    
    <meta property="og:title" content="Ananke: a Hugo Theme" />
<meta property="og:description" content="The last theme you&#39;ll ever need. Maybe." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://ooneko.github.io/" />

<meta property="og:updated_time" content="2020-02-08T15:52:58+08:00" />
<meta itemprop="name" content="Ananke: a Hugo Theme">
<meta itemprop="description" content="The last theme you&#39;ll ever need. Maybe.">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ananke: a Hugo Theme"/>
<meta name="twitter:description" content="The last theme you&#39;ll ever need. Maybe."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-150758987-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  
  
  <header class="cover bg-top" style="background-image: url('https://ooneko.github.io/images/gohugo-default-sample-hero-image.jpg');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://ooneko.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      华彬闳的Blog
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/posts/" title="Posts page">
              Posts
            </a>
          </li>
          
        </ul>
      
      







<a href="https://github.com/ooneko" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>





    </div>
  </div>
</nav>

      <div class="tc-l pv4 pv6-l ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 white-90 mb0 lh-title">
          Ananke: a Hugo Theme
        </h1>
        
          <h2 class="fw1 f5 f3-l white-80 measure-wide-l center mt3">
            The last theme you&#39;ll ever need. Maybe.
          </h2>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray">
    <p>Welcome to my blog with some of my work in progress. I&rsquo;ve been working on this book idea. You can read some of the chapters below.</p>

  </article>
  
  
  
  
  
  
  
    
    

    <div class="pa3 pa4-ns w-100 w-70-ns center">
      
       
          <h1 class="flex-none">
            Recent Posts
          </h1>
        

      

      <section class="w-100 mw8">
        
        
          <div class="relative w-100 mb4">
            
<article class="bb b--black-10">
  <div class="db pv4 ph3 ph0-l no-underline dark-gray">
    <div class="flex flex-column flex-row-ns">
      
          
        
        <div class="pr3-ns mb4 mb0-ns w-100 w-40-ns">
          <a href="/posts/how_to_write_ansible_module/" class="db grow">
            <img src="https://ooneko.github.io/images/notebook.jpg" class="img" alt="image from 如何编写Ansible module">
          </a>
        </div>
      
      <div class="blah w-100 w-60-ns pl3-ns">
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="/posts/how_to_write_ansible_module/" class="color-inherit dim link">
            如何编写Ansible module
            </a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          如果你想要开发Ansible Module, 想必你已经知道了什么是Ansible Module. 比如以下这段Ansible Task:
- name: Ensure container-selinux exist yum: name: &quot;container-selinux&quot;  调用了yum这个Module, 它的目的是通yum 在系统上安装 container-selinux 这个包, 如果系统中已存在这个包, 就不会再安装它.
Module 很重要的一个特性就是幂等性. 在上面这段代码就可以翻译成一句描述: &ldquo;在系统中存在一个rpm包, 并且它是通过yum安装的.&rdquo; 而这句话的背后是如何实现的, 就是Module需要做的事情了.
准备开发环境: 1. clone ansible 代码 git clone https://github.com/ansible/ansible.git 2. 进入ansible 目录 cd ansible 3. 创建虚拟环境 python3 -m venv venv 4. 进入虚拟环境 . venv/bin/activate 5. 安装依赖 pip install -r requirements.txt 6.
        </div>
          <a href="/posts/how_to_write_ansible_module/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
        
      </div>
    </div>
  </div>
</article>

          </div>
        
          <div class="relative w-100 mb4">
            
<article class="bb b--black-10">
  <div class="db pv4 ph3 ph0-l no-underline dark-gray">
    <div class="flex flex-column flex-row-ns">
      
      <div class="blah w-100">
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="/posts/rpm_packaging/" class="color-inherit dim link">
            RPM Packaging
            </a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          作为Linux 用户, 你是希望在安装软件的时候, 去下载, 编译, 拷贝二进制, 拷贝配置文件, 运行脚本, 创建用户.等等, 还是希望通过一条命令把软件给安装好?
或者是分发软件的时候告诉人们, 先编译,再安装依赖, 然后拷贝配置文件, 创建用户&hellip;. 还是告诉人们, yum install it ?
通过将软件打包成RPM包, 可以极大的简化软件分发,部署的成本. 还包括安装, 升级, 删除 等等.
利用RPM, 还可以很方便的进行版本管理, RPM有一个数据用于记录软件包的Metadata, 以及安装了哪些文件. 因为有一个统一存储版本的数据库, 所以这样可以使我们更容易做版本管理.
从运维的角度来说, 所安装的软件最好有一个统一的地方维护已安装的软件的列表以及版本. 通过查询这个数据库, 就可以知道这个软件有没有安装, 安装的是什么版本. 如果你已经想通过RPM开始打包你的应用, 需要确认你的应用是哪种语言类型.
程序的类型 因为不同的类型有不同的打包方法.
从代码-机器码的角度上来看, 源码分为两种类型: 编译型, 解释型, 还有编译解释型.
编译型
编译型语言需要将源码编译成二进制文件, 才可以执行.
运行这些二进文件时, CPU 可以直接加载这些程序.
编译型的语言有Go, C, C++. 等等.
解释型
典型的解释型语言就是Bash, bash 可以直接运行shell文件. 无需编译.
编译解释型
编译解释型语言有Java, Python. 这类语言需要将源码编译成字节码. 然后再由解释器运行字节码. 在运行时将字节码翻译成机器码发送给CPU去执行.
编译型语言 以Go为示例, 写一个 hello world.
        </div>
          <a href="/posts/rpm_packaging/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
        
      </div>
    </div>
  </div>
</article>

          </div>
        
          <div class="relative w-100 mb4">
            
<article class="bb b--black-10">
  <div class="db pv4 ph3 ph0-l no-underline dark-gray">
    <div class="flex flex-column flex-row-ns">
      
      <div class="blah w-100">
        <h1 class="f3 fw1 athelas mt0 lh-title">
          <a href="/posts/mysql_replication_with_haproxy/" class="color-inherit dim link">
            如何利用HAProxy 代理 MySQL Master-Slave Replication
            </a>
        </h1>
        <div class="f6 f5-l lh-copy nested-copy-line-height nested-links">
          背景 我有一个MySQL Master-Slave Replication, 想要通过HAProxy代理, 做读写分离.
写流量给到Master 节点, 读流量给到Slave 节点.
首先我应该由一个HAProxy的配置, 我想应该这样写(伪配置):
listen mysql bind *:3316 mode tcp ... server 192.168.1.111 192.168.1.111:3306 check server 192.168.1.112 192.168.1.112:3306 check server 192.168.1.113 192.168.1.113:3306 check  很明显, 这么写仅仅只实现了流量的分发, 但并不能实现我的需求: 把写流量给Master, 读流量给Slave 节点.
那么问题来了,首先我要能够识别Master Slave 节点, 才能有接下来的流量分离.
HAProxy有个配置项叫做 mysql-check. 但是这里并不能用它去做Master-Slave的检测,因为这个option只提供存活检测. 只要能够连上,就代表这个mysql后端是Health OK的.
这还是不符合我的需求.
MySQL 如果能够通过tcp-check 检测是Master还是Slave就好了.
既然这样, 写一个TCP-check Wrapper 不就可以了?
TCP-Check-Wrapper 这个Wrapper应该监听在TCP端口上,并以守护进程的方式运行. 当HAproxy连接至其监听的端口时, 会执行相应的脚本, 并将脚本执行结果通过 TCP 连接发送至Haproxy.
代码如下: - TCP-Check-Wrapper - mysqlchk
放置好mysqlchk 脚本, 然后在每个MySQL节点上把tcp-check-wrapper服务跑起来.
        </div>
          <a href="/posts/mysql_replication_with_haproxy/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
        
      </div>
    </div>
  </div>
</article>

          </div>
        
      </section>

      
      <section class="w-100">
        <h1 class="f3">More</h1>
        
        
          <h2 class="f5 fw4 mb4 dib mr3">
            <a href="/posts/how_to_write_ansible_filters/" class="link black dim">
              如何编写 ANSIBLE FILTER PLUGINS
            </a>
          </h2>
        
          <h2 class="f5 fw4 mb4 dib mr3">
            <a href="/posts/2019-03-05-howto-test-infinite-loop/" class="link black dim">
              如何测试&#34;无限循环&#34;的代码
            </a>
          </h2>
        
          <h2 class="f5 fw4 mb4 dib mr3">
            <a href="/posts/2018-12-11-bash_brace_expansion/" class="link black dim">
              Bash brace expansion
            </a>
          </h2>
        
          <h2 class="f5 fw4 mb4 dib mr3">
            <a href="/posts/centos7_network_device_naming/" class="link black dim">
              浅谈 CentOS/RHEL 7 下的网络设备命名规则
            </a>
          </h2>
        

        
        
          <a href="/posts/" class="link db f6 pa2 br3 bg-mid-gray white dim w4 tc">All Posts</a>
        
        </section>
      

      </div>
  

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://ooneko.github.io/" >
    &copy; 2020 华彬闳的Blog
  </a>
    <div>







<a href="https://github.com/ooneko" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>




</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
